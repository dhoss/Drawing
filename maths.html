<html>
 <head>
  <script type="application/javascript">
  function draw() {
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");
    ctx.save();
    var h = offset(2);
    var hour_x   = h[0] * 25;
    var hour_y   = h[1] * 25;
    ctx.fillStyle = "rgb(200,0,0)";
  
    circle(ctx);
    update_hour(ctx);
    update_minute(ctx);
    update_second(ctx);
    hour_ticks(ctx);
    //ctx.restore();
  }

  function offset ( h, is_hr ) {
    var x,y;
    if ( is_hr == 1 ) {
      h = h >=12 ? h-12 : 0;
      console.log("HOUR IS " + h);
      x = Math.sin((h)*2.0*Math.PI);
      y = Math.cos((h)*2.0*Math.PI);
      console.log("HOUR COORDS " + x + ", " + y);
    } else {
      x = Math.sin((h/12.0)*2.0*Math.PI);
      y = Math.cos((h/12.0)*2.0*Math.PI);
    }
    var coords = new Array(2);
    coords[0] = x;
    coords[1] = y;
    return coords;
  }
  
  function hour_ticks ( ctx ) {
    ctx.save();
    for ( var i=0; i<12; i++ ) {	  
      ctx.beginPath();
      var tick = offset(i);
      var x = tick[0];
      var y = tick[1];
      ctx.moveTo(150+(x*50),150-(y*50));            
      ctx.lineTo(150+(x*35),150-(y*35));
      ctx.stroke();
    }
    ctx.restore();
  }

  function circle ( ctx ) {
    ctx.beginPath();
    ctx.arc(150, 150, 50, 0, Math.PI*2, true);
    ctx.stroke();
    ctx.save();
  }

  function hour_hand ( ctx, hour_x, hour_y ) {
    draw_hand(ctx, 150, 150, hour_x, hour_y);    
  }

  function minute_hand ( ctx, minute_x, minute_y ) {
    draw_hand(ctx, 150, 150, minute_x, minute_y);
  }

  function second_hand ( ctx, second_x, second_y ) {
    draw_hand(ctx, 150, 150, second_x, second_y);
  }
    
  function draw_hand ( ctx, origin_x, origin_y, hand_x, hand_y ) {
    ctx.save();
    ctx.moveTo(origin_x, origin_y);
    ctx.lineTo(origin_x+hand_x, origin_y-hand_y);
    ctx.stroke();
    ctx.restore();
  }

  function update_minute ( ctx ) {
    var time = new Date();
    var m = offset((Math.PI/30)*time.getMinutes() + (Math.PI/1800)*time.getSeconds());
    var minute_x = m[0] * 50;
    var minute_y = m[1] * 50;
    console.log('updating minute hand');
    minute_hand(ctx, minute_x, minute_y);
  }

  function update_hour ( ctx ) { 
    var time = new Date();
    var h = offset(
      (Math.PI/6)     * time.getHours()     + 
      (Math.PI/360)   * time.getMinutes()   + 
      (Math.PI/21600) * time.getSeconds(),
      1
    );
    var hour_x = h[0]*35;
    var hour_y = h[1]*35;
    console.log('updating hour hand');
    hour_hand(ctx, hour_x, hour_y);
  }

  function update_second ( ctx ) {
    var time = new Date();
    var s = offset(time.getSeconds() * Math.PI/30);
    var second_x = s[0]*48;
    var second_y = s[1]*48;
    console.log("updating second hand");
    second_hand(ctx, second_x, second_y);
  }

  function init () {
    draw(); 
    setInterval(draw, 300);
  }
</script>
</head>
<body onload="init()">
<canvas id="canvas" width="300" height="300"></canvas>
</body>
</html>
